"use strict";var WaveformGenerator=function(t,e){function a(){return"a"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)+"b"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function o(t,e){var a=d.barWidth;0!==d.barGap&&(a*=Math.abs(1-d.barGap));var o,r=t+a/2;switch(d.barAlign){case"top":o=0;break;case"center":o=d.waveformHeight/2-e/2;break;case"bottom":o=d.waveformHeight-e}if("png"===d.drawMode){r=Math.floor(r-1),o=Math.floor(o-1);var n=c.getContext("2d");n.fillStyle=d.waveformColor,n.fillRect(r,o,a,e)}else if("svg"===d.drawMode){var i=document.createElement("path");i.setAttribute("d","M"+r+" "+o+" L"+r+" "+o+" L"+r+" "+(o+e)+" L"+r+" "+(o+e)+" L"+r+" "+o+" Z"),i.className=h.id,h.appendChild(i)}}function r(t,e,a){for(var o=0,r=t,n=t+e-1;n>=t?n>=r:r>=n;n>=t?r++:r--)o+=Math.pow(a[r],2);return Math.sqrt(o/a.length)}function n(t){return new Promise(function(e,a){t=t.getChannelData(0);for(var n=d.waveformWidth,i=Math.floor(t.length/n),l=[],s=[],h=0;n>h;h+=d.barWidth){var v={};v.position=h,v.height=r(h*i,i,t),s.push(v.height),l.push(v)}for(var c=d.waveformHeight/Math.max.apply(null,s),h=0;h<l.length;h++){var g=l[h],u=g.height,f=g.position;u*=c,o(f,u)}e()})}function i(t,e){return new Promise(function(o,r){s.decodeAudioData(t,function(t){if(!t)return void r(new Error("Could not decode audio data"));d=Object.assign({},l),d=Object.assign(d,e);var i=a();h=document.createElement("svg"),h.id=i,h.setAttribute("xmlns","http://www.w3.org/2000/svg"),h.setAttribute("version","1.1"),h.setAttributeNS(null,"viewBox","0 0 "+d.waveformWidth+" "+d.waveformHeight),v=document.createElement("style"),v.setAttribute("type","text/css"),v.appendChild(document.createTextNode("<![CDATA[path."+h.id+"{stroke:"+d.waveformColor+";stroke-width:"+(0!==d.barGap?d.barWidth*Math.abs(1-d.barGap):d.barWidth)+"}]]>")),h.appendChild(v),c=document.createElement("canvas"),c.id=i,c.width=d.waveformWidth,c.height=d.waveformHeight;var s=c.getContext("2d");s.clearRect(0,0,c.width,c.height),n(t).then(function(){if("svg"===d.drawMode){var t=URL.createObjectURL(new Blob(['<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+h.outerHTML],{type:"image/svg+xml"}));console.log("Resolving "+i),o(t)}else"png"===d.drawMode&&(console.log("Resolving "+i),console.log("Resolving canvas #"+c.id),o(c.toDataURL()))})})})}var d=void 0,l={waveformWidth:500,waveformHeight:80,waveformColor:"#bada55",barAlign:"center",barWidth:1,barGap:0,drawMode:"png"},s=new AudioContext||new WebkitAudioContext,h=null,v=null,c=null;return i}();
//# sourceMappingURL=WaveformGenerator.js.map
