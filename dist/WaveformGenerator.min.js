window.AudioContext=window.AudioContext||window.webkitAudioContext;var WaveformGenerator={tmp:{bar:{width:1,gap:0},wave:{color:"#bada55",alignment:"bottom"},audioContext:new AudioContext},generate:function(t,e,a,r,i,n,o,s){if(8!==arguments.length)return this.error("Not enough arguments"),void 0;this.tmp.canvas=document.createElement("canvas");var h=this.tmp.canvas;h.width=void 0!==e?parseInt(e):200,h.height=void 0!==a?parseInt(a):100,this.tmp.wave.color=void 0!==r?r:"black",this.tmp.wave.alignment=void 0!==i?i:"black",this.tmp.bar.width=void 0!==n?parseInt(n):1,this.tmp.bar.gap=void 0!==o?parseFloat(o):0,this.tmp.retFunc=s,this.tmp.svg=document.createElement("svg");var d=this.tmp.svg;d.setAttribute("xmlns","http://www.w3.org/2000/svg"),d.setAttribute("version","1.1"),d.setAttribute("width","100%"),d.setAttribute("height","100%"),d.setAttributeNS(null,"viewBox","0 0 "+h.width+" "+h.height);var m=document.createElement("style");m.setAttribute("type","text/css");var p=document.createTextNode("<![CDATA[path{stroke:"+this.tmp.wave.color+";stroke-width:"+(0!==this.tmp.bar.width?this.tmp.bar.width*Math.abs(1-this.tmp.bar.gap):this.tmp.bar.width)+"}]]>");m.appendChild(p),d.appendChild(m);var v=new FileReader;v.onload=function(t){WaveformGenerator.tmp.audioContext.decodeAudioData(t.target.result,function(t){WaveformGenerator.extractBuffer(t)})},v.readAsArrayBuffer(t)},error:function(t){console.error(t)},extractBuffer:function(t){t=t.getChannelData(0);for(var e=this.tmp.canvas.width,a=Math.floor(t.length/e),r=0;e>r;r+=this.tmp.bar.width){var i=r*a;this.drawBar(r,this.bufferMeasure(i,a,t))}r>=e&&WaveformGenerator.tmp.retFunc(this.tmp.canvas.toDataURL(),URL.createObjectURL(new Blob(['<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+this.tmp.svg.outerHTML],{type:"image/svg+xml"})))},bufferMeasure:function(t,e,a){for(var r=0,i=t,n=t+e-1;n>=t?n>=i:i>=n;n>=t?i++:i--)r+=Math.pow(a[i],2);return Math.sqrt(r/a.length)},drawBar:function(t,e){var a=this.tmp.canvas,r=this.tmp.canvas.getContext("2d");r.fillStyle=this.tmp.wave.color;var i=40*e*a.height,n=this.tmp.bar.width;0!==this.tmp.bar.gap&&(n*=Math.abs(1-this.tmp.bar.gap));var o=t+n/2,s=a.height-i,h=document.createElement("path");return s="center"===this.tmp.wave.alignment?a.height/2-i/2:s,h.setAttribute("d","M"+o+" "+s+" L"+o+" "+s+" L"+o+" "+(s+i)+" L"+o+" "+(s+i)+" L"+o+" "+s+" Z"),this.tmp.svg.appendChild(h),r.fillRect(t,s,n,i)}};