window.AudioContext=window.AudioContext||window.webkitAudioContext,Array.prototype.max=function(){return Math.max.apply(null,this)};var WaveformGenerator={tmp:{bar:{width:1,gap:0},wave:{color:"#bada55",alignment:"bottom"},audioContext:new AudioContext},generate:function(t,e,a,r,i,n,o,s){if(8!==arguments.length)return this.error("Not enough arguments"),void 0;this.tmp.canvas=document.createElement("canvas");var h=this.tmp.canvas;h.width=void 0!==e?parseInt(e):200,h.height=void 0!==a?parseInt(a):100,this.tmp.wave.color=void 0!==r?r:"black",this.tmp.wave.alignment=void 0!==i?i:"black",this.tmp.bar.width=void 0!==n?parseInt(n):1,this.tmp.bar.gap=void 0!==o?parseFloat(o):0,this.tmp.retFunc=s,console.debug(this.tmp),this.tmp.svg=document.createElement("svg");var p=this.tmp.svg;p.setAttribute("xmlns","http://www.w3.org/2000/svg"),p.setAttribute("version","1.1"),p.setAttribute("width","100%"),p.setAttribute("height","100%"),p.setAttributeNS(null,"viewBox","0 0 "+h.width+" "+h.height);var m=document.createElement("style");m.setAttribute("type","text/css");var d=document.createTextNode("<![CDATA[path{stroke:"+this.tmp.wave.color+";stroke-width:"+(0!==this.tmp.bar.width?this.tmp.bar.width*Math.abs(1-this.tmp.bar.gap):this.tmp.bar.width)+"}]]>");m.appendChild(d),p.appendChild(m);var u=new FileReader;u.onload=function(t){WaveformGenerator.tmp.audioContext.decodeAudioData(t.target.result,function(t){WaveformGenerator.extractBuffer(t)})},u.readAsArrayBuffer(t)},error:function(t){console.error(t)},extractBuffer:function(t){t=t.getChannelData(0);for(var e=this.tmp.canvas.width,a=Math.floor(t.length/e),r=this.tmp.canvas.height,i=[],n=0;e>n;n+=this.tmp.bar.width)i.push(1e4*this.bufferMeasure(n*a,a,t));for(var n=0;e>n;n+=this.tmp.bar.width){var o=r/i.max(),s=1e4*this.bufferMeasure(n*a,a,t);s*=o,s+=1,this.drawBar(n,s)}n>=e&&WaveformGenerator.tmp.retFunc(this.tmp.canvas.toDataURL(),URL.createObjectURL(new Blob(['<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+this.tmp.svg.outerHTML],{type:"image/svg+xml"})))},bufferMeasure:function(t,e,a){for(var r=0,i=t,n=t+e-1;n>=t?n>=i:i>=n;n>=t?i++:i--)r+=Math.pow(a[i],2);return Math.sqrt(r/a.length)},drawBar:function(t,e){var a=this.tmp.canvas,r=this.tmp.canvas.getContext("2d");r.fillStyle=this.tmp.wave.color;var i=this.tmp.bar.width;0!==this.tmp.bar.gap&&(i*=Math.abs(1-this.tmp.bar.gap));var n=t+i/2,o=a.height-e,s=document.createElement("path");return o="center"===this.tmp.wave.alignment?a.height/2-e/2:o,s.setAttribute("d","M"+n+" "+o+" L"+n+" "+o+" L"+n+" "+(o+e)+" L"+n+" "+(o+e)+" L"+n+" "+o+" Z"),this.tmp.svg.appendChild(s),r.fillRect(n,o,i,e)}};